#include <stdio.h>
#include <string.h>
#include <openssl/aes.h>
#include <openssl/md5.h>


unsigned char thunder[]={
	0x34,0x00,0x00,0x00,0x96,0x00,0x00,0x00};
//	0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//	0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
//	0x40,0x00,0x00,0x00,0x00,0x00,0x00,0x00};

unsigned char thunder_AES_key[16] = {0xf5,0x26,0x32,0xd9,0x0b,0x36,0xf0,0x58,0x25,0x53,0x71,0xa2,0xae,0x2f,0x3e,0xd3};//thunder MD5 padding data

unsigned char in[]={0x02,0x3A,0xA0,0x8A,0x5E
	,0x52,0x22,0xAC,0x5E,0xFA,0xC8,0xF6,0x54,0xE8,0xDC,0x9A,0xBC,0xE6,0x78,0x11,0xD9
		,0x59,0xC3,0xE8,0x64,0x8E,0xB8,0x93,0xEA,0xE7,0x43,0x28,0xBA,0x16,0xFF,0xC4,0xA9
		,0xDC,0xAB,0x26,0x7C,0x56,0x08,0x47,0xD9,0xA9,0x37,0xF6,0xC1,0x3A,0x7B,0x68,0xC8
		,0x11,0x74,0x9D,0x62,0x6D,0x4C,0x6C,0xE7,0xAD,0x08,0x46,0x70,0x31,0xAC,0x97,0x34
		,0xAE,0x15,0x18,0x37,0xB3,0x97,0x32,0x91,0x13,0xF8,0xFB,0xAA,0x30,0x75,0x10,0x02
		,0x78,0x8E,0xF6,0x38,0x1D,0x43,0x6B,0xB9,0xF4,0xDE,0xC4,0x09,0x23,0x3A,0x27,0x8B
		,0xE6,0x2C,0x5D,0x87,0xBF,0x4C,0xBF,0xBF,0x54,0x15,0x4E,0xDB,0x8F,0x77,0x95,0xC0
		,0x67,0xEE,0x1E,0xB4,0xB4,0x36,0xF6,0xEF,0xCF,0x96,0x77,0x1A,0xEA,0x9E,0x63,0x11
		,0x40,0xFC,0xE1,0x23,0x81,0x90,0x92,0x5E,0xFE,0x23,0x36,0xFB,0x1A,0x23,0x37,0x9A
		,0x7D,0x20,0x95,0xCA,0x47,0xC2,0xDA,0xE9,0xE8,0xFE,0x30,0x4C,0xA0,0xFE,0x4F,0x6E
		,0xA0,0xA5,0x81,0x45,0xBA,0xAF,0x68,0xEE,0x60,0xA1,0xD5,0x00,0xA8,0xDC,0xCC,0x80
		,0x84,0x0C,0x19,0xCF,0x81,0xB9,0x13,0xC0,0x13,0x07,0xE8,0x70,0x05,0x79,0x15,0xF5
		,0xD5,0x2B,0x05,0xA1,0xDD,0x34,0xD8,0xD9,0xC3,0xE7,0x05,0x70,0x05,0x79,0x15,0xF5
		,0xD5,0x2B,0x05,0xA1,0xDD,0x34,0xD8,0xD9,0xC3,0xE7,0x05,0x70,0x05,0x79,0x15,0xF5
		,0xD5,0x2B,0x05,0xA1,0xDD,0x34,0xD8,0xD9,0xC3,0xE7,0x05,0x10,0x3A,0xCC,0x2F,0x13
		,0xE1,0xE1,0x8C,0x7B,0xC9,0xC5,0x48,0xB3,0x85,0x73,0x55,0x87,0xEE,0x99,0x14,0x67
		,0xB2,0x1B,0x01,0x1B,0x56,0x01,0x2F,0xFB,0x47,0x07,0x88,0xBD,0x4C,0xD2,0x1A,0x08
		,0x14,0x42,0xF3,0xF5,0xC2,0x7C,0x26,0x9E,0x24,0x00,0xA4,0xEA,0x5F,0x20,0xFC,0xCA
		,0x80,0xF6,0x9B,0xC9,0x28,0x5B,0x55,0x22,0x94,0x33,0x4F,0x3E,0x1B,0xC6,0x31,0x23
		,0x82,0xB1,0x97,0x3E,0xC1,0x00,0x2F,0xEF,0xCE,0x06,0x7B,0xAA,0xCD,0xA6,0x61,0xF5
		,0xC9,0x59,0x8E,0xDB,0xF6,0x49,0x73,0x9C,0xB9,0x08,0x05,0xC3,0x1E,0xEB,0xA6,0xD3
		,0x0F,0xBB,0x86,0xFD,0xFC,0xCC,0x99,0x89,0x61,0xA9,0xB1,0xF9,0x30,0xC7,0x48,0xB1
		,0x79,0x6C,0x75,0x26,0x8C,0xF5,0x46,0xF4,0x7F,0x04,0xED,0xD1,0x2B,0x16,0x2D,0x94
		,0x2F,0x2C,0xDE,0x6E,0x7B,0x97,0xE7,0x28,0x8B,0xDA,0x0D};//Encrypt data

unsigned char thunder2[]={0x41,0x00,0x00,0x00,0x11,0x00,0x00,0x00,0x80,0x00,0x00,0x00};
unsigned char in2[] = {
0xd6,0xe6,0x15,0xb2,0x04,0x93,0x18,0x8e,
0x5a,0xbe,0x3f,0x39,0xc2,0x16,0xe5,0xc7,
0x1b,0x84,0x8a,0x83,0xe2,0xd1,0x5d,0x78,
0x24,0x61,0x0b,0x51,0xb5,0x46,0x68,0x19,
0xdb,0xd6,0xe9,0x54,0xff,0x2c,0x5f,0xe3,
0x3e,0x72,0x67,0xfa,0x91,0x66,0x69,0xfd,
0x71,0x55,0x5c,0x2d,0xbf,0x99,0x77,0x07,
0xe4,0x1f,0xb3,0x6b,0xba,0xbb,0xb8,0xe9,
0xaf,0x72,0xc2,0xb3,0x67,0xa0,0xd3,0x23,
0x10,0x68,0x2a,0xad,0xa9,0xad,0xed,0x93,
0xb6,0x80,0x07,0xa1,0x08,0x12,0x1a,0x5f,
0x51,0x1b,0x9a,0x0d,0x16,0xb5,0x34,0xa9,
0x57,0xf5,0x60,0x15,0x54,0x7e,0xf8,0xac,
0x6e,0x6e,0x44,0x76,0x78,0x0e,0xd7,0x72,
0x8a,0x2f,0x79,0xe6,0xf9,0xbe,0xf3,0x60,
0xd1,0x7b,0xea,0x8b,0x26,0x30,0xd2,0xe5};

unsigned char out[4096];

int main(int argc, char *argv[])
{
	unsigned char key[MD5_DIGEST_LENGTH];
	AES_KEY aes_key;
	int i,j;

	MD5(thunder, 122, key);

	printf("--------------------------------------------------\n");
	for (i = 0; i < MD5_DIGEST_LENGTH; ++i)
	{
		printf("%02x ",key[i]);
	}

	printf("\n--------------------------------------------------\n");

	strncpy((char*)&thunder_AES_key, (const char *)key, 16);

	AES_set_decrypt_key((const unsigned char *)&thunder_AES_key, 128, &aes_key);
	for ( i=0;i<sizeof(in)/16;i++)
	{
		AES_decrypt((const unsigned char *)&in[i*16], (unsigned char *)&out[i*16],&aes_key);
	}

	for ( i=0;i<sizeof(in)/16;i++)
	{
		for ( j=0;j<16;j++)
		{
			printf("%02x ",out[i*16+j]);
		}
		printf("    ");
		for ( j=0;j<16;j++)
		{
			printf("%c",out[i*16+j]);
		}
		printf("\n");
	}
	MD5(thunder2, 8, key);

	printf("\n\n--------------------------------------------------\n");
	for (i = 0; i < MD5_DIGEST_LENGTH; ++i)
	{
		printf("%02x ",key[i]);
	}

	printf("\n--------------------------------------------------\n");

	strncpy((char*)&thunder_AES_key, (const char *)key, 16);

	AES_set_decrypt_key((const unsigned char *)&thunder_AES_key, 128, &aes_key);
	for ( i=0;i<sizeof(in2)/16;i++)
	{
		AES_decrypt((const unsigned char *)&in[i*16], (unsigned char *)&out[i*16],&aes_key);
	}

	for ( i=0;i<sizeof(in2)/16;i++)
	{
		for ( j=0;j<16;j++)
		{
			printf("%02x ",out[i*16+j]);
		}
		printf("    ");
		for ( j=0;j<16;j++)
		{
			printf("%c",out[i*16+j]);
		}
		printf("\n");
	}
	return 0;
}
